{% extends 'core/base.html' %}
{% load static %}
{% block title %}Settings - VetStock{% endblock %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@100..900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'core/css/settings.css' %}">

<div class="page-header">
    <h1 class="page-title"><i class="fa-solid fa-cog"></i> Paramètres</h1>
    <p class="page-subtitle">Gérez vos préférences de compte et les paramètres du système</p>
</div>

<!-- Affichage des messages -->
{% if messages %}
    {% for message in messages %}
        <div class="alert {% if message.tags == 'error' %}alert-error{% elif message.tags == 'warning' %}alert-warning{% else %}alert-success{% endif %}">
            {{ message }}
        </div>
    {% endfor %}
{% endif %}

<!-- Carte d'information utilisateur -->
<div class="settings-card">
    <div class="user-info">
        <div class="user-details">
            <h3>{{ user.get_full_name|default:user.username }}</h3>
            <p>{{ user.email }}</p>
            {% if profile %}
                <span class="role-badge">{{ profile.get_role_display }}</span>
            {% endif %}
        </div>
    </div>
</div>

<div class="settings-container">
    <!-- Paramètres du profil -->
    <div class="settings-card">
        <h3 class="card-title"><i class="fa-solid fa-user"></i> Paramètres du profil</h3>
        <form method="post" class="settings-form">
            {% csrf_token %}
            <div class="form-group">
                <label class="form-label">Prénom</label>
                <input type="text" name="first_name" class="form-input" 
                       value="{{ user.first_name|default:'' }}" placeholder="Entrez votre prénom">
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom</label>
                <input type="text" name="last_name" class="form-input" 
                       value="{{ user.last_name|default:'' }}" placeholder="Entrez votre nom">
            </div>
            
            <div class="form-group">
                <label class="form-label">Adresse e-mail</label>
                <input type="email" name="email" class="form-input" 
                       value="{{ user.email|default:'' }}" placeholder="Entrez votre adresse e-mail">
            </div>
            
            <div class="form-group">
                <label class="form-label">Numéro de téléphone</label>
                <input type="tel" name="phone" class="form-input" 
                       value="{{ profile.phone|default:'' }}" placeholder="Entrez votre numéro de téléphone">
            </div>
            
            <div class="form-group">
                <label class="form-label">Adresse</label>
                <input type="text" name="address" class="form-input" 
                       value="{{ profile.address|default:'' }}" placeholder="Entrez votre adresse">
            </div>
            
            <button type="submit" name="update_profile" class="btn btn-primary">
                <i class="fa-solid fa-save"></i> Mettre à jour le profil
            </button>
        </form>
    </div>

    <!-- Changer le mot de passe -->
    <div class="settings-card">
        <h3 class="card-title"><i class="fa-solid fa-lock"></i> Changer le mot de passe</h3>
        <form method="post" class="settings-form">
            {% csrf_token %}
            <div class="form-group">
                <label class="form-label">Mot de passe actuel</label>
                <input type="password" name="current_password" class="form-input" 
                       placeholder="Entrez votre mot de passe actuel" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nouveau mot de passe</label>
                <input type="password" name="new_password" class="form-input" 
                       placeholder="Entrez votre nouveau mot de passe" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Confirmez le nouveau mot de passe</label>
                <input type="password" name="confirm_password" class="form-input" 
                       placeholder="Confirmez votre nouveau mot de passe" required>
            </div>
            
            <button type="submit" name="change_password" class="btn btn-warning">
                <i class="fa-solid fa-lock"></i> Changer le mot de passe
            </button>
        </form>
    </div>

    <!-- Actions rapides -->
    <div class="settings-card">
        <h3 class="card-title"><i class="fa-solid fa-bolt"></i> Actions rapides</h3>

        <div class="quick-actions">
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                <i class="fa-solid fa-house"></i> Aller au tableau de bord
            </a>
            
            <a href="{% url 'users' %}" class="btn btn-secondary">
                <i class="fa-solid fa-users"></i> Gérer l'équipe
            </a>
            
            <a href="{% url 'logs' %}" class="btn btn-secondary">
                <i class="fa-solid fa-file-alt"></i> Voir les journaux d'activité
            </a>
            
            <a href="{% url 'report' %}" class="btn btn-secondary">
                <i class="fa-solid fa-chart-line"></i> Envoyer des rapports
            </a>
        </div>
    </div>
</div>

<!-- Zone de danger -->
<div class="danger-zone">
    <h3 class="card-title"><i class="fa-solid fa-exclamation-triangle"></i> Zone de danger</h3>
    <p class="danger-warning">
        Ces actions sont irréversibles. Veuillez faire attention.
    </p>
    
    <div class="danger-actions">
        <a href="{% url 'logout' %}" class="btn btn-danger" 
           onclick="return confirm('Êtes-vous sûr de vouloir vous déconnecter ?');">
            <i class="fa-solid fa-door-open"></i> Se déconnecter
        </a>
        
        {% if user.is_superuser %}
        <a href="/admin/" class="btn btn-warning" target="_blank">
            <i class="fa-solid fa-tools"></i> Panneau d'administration
        </a>
        {% endif %}
    </div>
</div>

{% endblock %}
